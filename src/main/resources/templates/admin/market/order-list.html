<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org"
      th:replace="~{admin/layout :: layout('주문/결제 목록', ~{::content}, ~{::scripts})}">
<body>
<div th:fragment="content">

  <div class="page-header">
    <h2>주문/결제 목록</h2>
  </div>

  <form th:action="@{/admin/orders}" method="get"
        class="search-form"
        style="display:flex; align-items:center; gap:10px; margin: 0 15px 20px;">
    <label for="status" style="font-weight:600; font-size:14px;">
      주문상태
    </label>
    <select id="status" name="status"
            style="height:40px; padding:6px 10px; border:1px solid #ccc; border-radius:6px; width:150px;">
      <option th:value="${null}"
              th:selected="${selectedStatus == null}">
        전체
      </option>
      <option th:each="st : ${T(org.example.stamppaw_backend.market.entity.OrderStatus).values()}"
              th:value="${st}"
              th:selected="${selectedStatus == st}"
              th:text="${st}">
      </option>
    </select>
    <button class="btn btn-primary"
            style="padding:6px 14px; height:36px;">
      검색
    </button>
  </form>

  <div style="margin: 0px 15px;">
    <table class="admin-table">
      <thead>
      <tr>
        <th>ID</th>
        <th>주문자</th>
        <th>총 금액</th>
        <th>주문일</th>
        <th>주문</th>
        <th>배송</th>
        <th>상세보기</th>
      </tr>
      </thead>
      <tbody>
      <tr th:each="order : ${orders.content}">
        <td th:text="${order.orderId}"></td>
        <td th:text="${order.username}"></td>
        <td>
          상품 구매
          <span th:text="${#numbers.formatInteger(order.totalAmount, 3, 'COMMA')}"></span>
          +
          배송비
          <span th:text="${#numbers.formatInteger(order.shippingFee, 3, 'COMMA')}"></span>
          =
          <span th:text="${#numbers.formatInteger(order.totalAmount + order.shippingFee, 3, 'COMMA')}"></span>
          원
        </td>
        <td th:text="${#temporals.format(order.registeredAt, 'yyyy-MM-dd HH:mm')}"></td>
        <td th:text="${order.status}"></td>
        <td th:text="${order.shippingStatus}"></td>
        <td>
          <div style="display:flex; gap:8px; justify-content:center;">
            <a th:href="@{'/admin/orders/' + ${order.orderId}}" class="btn btn-primary btn-sm">
              상세보기
            </a>

            <!--form th:action="@{'/admin/orders/' + ${order.orderId} + '/delete'}"
                  method="post">
              <button type="submit" class="btn btn-third btn-sm"
                      onclick="return confirm('정말 삭제하시겠습니까?');">
                삭제
              </button-->
            </form>
          </div>
        </td>


      </tr>

      <tr th:if="${orders.totalElements == 0}">
        <td colspan="7" class="text-center">주문 내역이 없습니다.</td>
      </tr>
      </tbody>
    </table>
  </div>

  <div class="pagination" style="text-align:center; margin-top:20px;"
       th:if="${orders.totalPages > 0}">
    <a th:if="${orders.hasPrevious()}"
       th:href="@{/admin/orders(page=${orders.number - 1}, status=${selectedStatus})}"  style="margin: 0 5px;">
      이전
    </a>
    <span th:each="p : ${#numbers.sequence(0, orders.totalPages - 1)}"
          th:classappend="${p == orders.number} ? 'active'">
    <a th:href="@{/admin/orders(page=${p}, status=${selectedStatus})}"
       th:text="${p + 1}"></a>
  </span>
    <a th:if="${orders.hasNext()}"
       th:href="@{/admin/orders(page=${orders.number + 1}, status=${selectedStatus})}"  style="margin: 0 5px;">
      다음
    </a>
  </div>
</div>

<!-- scripts fragment(비어있어도 반드시 필요) -->
<th:block th:fragment="scripts"></th:block>

</body>
</html>
